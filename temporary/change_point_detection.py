import os
import logging
import matplotlib.pyplot as plt
import ruptures as rpt
import numpy as np

logging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')
logger = logging.getLogger(os.path.basename(__file__))
logger.setLevel(logging.DEBUG)

signal = [0.4690346084,0.4399071926,0.1353300055,0.2107503991,0.2471324296,0.09518413598,0.2679031427,0.1394576646,0.1238839286,0.1291040623,0.2136025505,0.2117021277,0.3071500504,0.3397530864,0.2323869611,0.2277279916,0.4245548266,0.3372898121,0.2589331952,0.2351706037,0.2011771001,0.3535749265,0.3105527638,0.2088438998,0.1787648971,0.1588170865,0.2811860941,0.2571280456,0.3639902676,0.246218049,0.4104018913,0.2968591692,0.3062972292,0.3339940535,0.1758003256,0.4230769231,0.3315136476,0.2776639344,0.2714652956,0.2652218782,0.07775871927,0.2925342814,0.3028773347,0.2687950566,0.2820643843,0.3298559364,0.3527682509,0.4134025484,0.3088531187,0.35599022,0.3687530325,0.4051233397,0.4081439394,0.2873153337,0.3298559364,0.3615984405,0.2907981698,0.2571280456,0.3147869674,0.3339940535,0.342209073,0.3381117153,0.3828763829,0.2838182746,0.3088531187,0.2864424057,0.3331680714,0.3519607843,0.2951318458,0.3281949279,0.3315136476,0.3381117153,0.3248629796,0.3348192174,0.3339940535,0.3315136476,0.3519607843,0.3535749265,0.3479115479,0.3567937439,0.2829417773,0.3139418255,0.3223552894,0.3298559364,0.3011622031,0.32319202,0.3298559364,0.3454724409,0.2899287894,0.2714652956,0.2607346094,0.3315136476,0.2899287894,0.2820643843,0.2516900676,0.2580310881,0.2705761317,0.2535064935,0.2616339193,0.2652218782,0.2239830956,0.2951318458,0.3339940535,0.3273631841,0.31984008,0.3290258449,0.3405725568,0.3583984375,0.3727008712,0.380539499,0.3535749265,0.386756238,0.3631937683,0.3671685284,0.3727008712,0.3671685284,0.344657804,0.367961165,0.3663751215,0.3639902676,0.3479115479,0.342209073,0.3519607843,0.350343474,0.3511525257,0.3742746615,0.3695441319,0.3703344644,0.367961165,0.3623964929,0.3639902676,0.3623964929,0.35518591,0.3462862764,0.350343474,0.350343474,0.3583984375,0.3462862764,0.3535749265,0.342209073,0.3413912185,0.344657804,0.3454724409,0.3454724409,0.3462862764,0.3479115479,0.3511525257,0.3535749265,0.3462862764,0.3454724409,0.350343474,0.3438423645,0.344657804,0.3413912185,0.3405725568,0.3405725568,0.3389328063,0.3339940535,0.3306852036,0.3348192174,0.3331680714,0.3331680714,0.32319202,0.31984008,0.3223552894]
signal = np.array(signal)

# detection
algo = rpt.Pelt(model="rbf").fit(signal)
result = algo.predict(pen=5)
print(result)
last_change_point = result[-2]
print(last_change_point)
last_chunk_median = np.median(signal[last_change_point:])
print("Median: {}".format(last_chunk_median))

# display
# rpt.display(signal, [], result)
# plt.show()
